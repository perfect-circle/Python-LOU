# 简介

知识点：

* ndarray 多维数组的创建；
* 多维数组的索引方式；
* 多维数组的运算规则；
* Series 和 DataFrame 数据集的创建；
* 数据集的数据项选择方式；
* 数据集的自动对齐规则；
* 数据集的合并方式；
* 缺失值的处理；
* 时间序列处理；

## 什么是Numpy

1. NumPy（Numerical Python 的简称），是高性能科学计算和数据分析的基础包。数据分析的基础是数据，原始数据应该在计算机中会以某种数据结构进行存储，后续的分析操作都是基于这些数据结构进行的。比较容易能想到，我们分析的数据大多都是二维的，有行和列之分，这样的数据刚开始可能存储在 Excel 或者数据库表之中。那么在 Python 中有没有什么软件包可以很方便的处理这种二维数据或者更多维的数据呢？ 那就是 NumPy !

2. NumPy 提供了对多维数组（矩阵）的高效支持，同时还有以下优点：

* ndarray, 核心数据结构，支持矢量运算的多维数组，在内存中进行连续存储；
* 各种操作多维数组和进行数组间运算的数学函数（不需要编写循环）；
* 用于集成其他编程语言的各种接口；

3. NumPy 本身没有提供高级的数据分析功能，但理解 NumPy 数组以及面向数组的各种计算有助于更加高效使用其他数据分析工具。

## 多维的创建

1. NumPy 的核心是多维数组，是通过 ndarray对象做到的，ndarray 对象是一个灵活的数据容器，可以基于此容器对数据进行各种运算。

2. 创建数组
```python
In [1]: import numpy as np

In [2]: a1 = np.array([1, 2, 3, 4])

# shape 表示获取多维数组各个维度的大小，返回一个元组
# a1 是一维数组，大小为 4
In [3]: a1.shape
Out[3]: (4,)

In [4]: a1.size
Out[4]: 4

In [5]: a1.dtype
Out[5]: dtype('int64')

In [6]: a2 = np.array([[1.0, 2.5, 3], [0.5, 4, 9]])

In [7]: a2.shape
Out[7]: (2, 3)

In [8]: a2.size
Out[8]: 6

In [9]: a2.min()
Out[9]: 0.5

In [10]: a2.dtype
Out[10]: dtype('float64')


In [11]: a1
Out[11]: array([1, 2, 3, 4])

In [12]: a2
Out[12]:
array([[ 1. ,  2.5,  3. ],
       [ 0.5,  4. ,  9. ]])
       
       In [13]: type(a1)
       Out[13]: numpy.ndarray
```

3. NumPy 还有多种方法可以创建多维数组：

* np.arange 类似于 Python 内置的 range，创建一维数组；
* np.ones 创建元素值全部为 1 的数组；
* np.zeros 创建元素值全为 0 的数组；
* np.empty 创建空值多维数组，只分配内存，不填充任何值；
* np.random.random 创建元素值为随机值的多维数组；

4. 以上全部函数都能接收一个 dtype 参数，用于指定多维数组元素的类型。而后四个函数需要通过元组指定创建的数组形状，比如 (2, 3) 指定创建数组为 2 行 3 列。当然 NumPy 既然支持多维数组，所以也可以创建三维，四维数组，只需要设置指定形状的元组长度为 3 和 4 即可。另外，可以通过 ndarray.ndim 属性得到数组的维度。

```python
In [66]: a1 = np.arange(4)

In [67]: a1
Out[67]: array([0, 1, 2, 3])

In [68]: a1.ndim
Out[68]: 1

In [69]: a2 = np.ones((4, 4), dtype=np.int64)

In [70]: a2
Out[70]:
array([[1, 1, 1, 1],
       [1, 1, 1, 1],
       [1, 1, 1, 1],
       [1, 1, 1, 1]])

In [71]: a2.dtype
Out[71]: dtype('int64')

In [72]: a2.ndim
Out[72]: 2

In [73]: a2.shape
Out[73]: (4, 4)

In [74]: a3 = np.zeros((2, 2))

In [75]: a3
Out[75]:
array([[ 0.,  0.],
       [ 0.,  0.]])

In [76]: a3.dtype
Out[76]: dtype('float64')

In [77]: a3.ndim
Out[77]: 2

In [78]: a4 = np.empty((3, 3), dtype=np.int64)

In [79]: a4
Out[79]:
array([[-9223372036854775808,  2305851784366203125,           4433051653],
       [          4433109136,           4471713328,           4467477112],
       [ 8070459307400441937, -9223372036854775808,           4434427906]])

In [80]: a4.dtype
Out[80]: dtype('int64')

In [81]: a4.shape
Out[81]: (3, 3)

In [82]: a4.ndim
Out[82]: 2

In [83]: a5 = np.ones((4, 3, 4))

In [84]: a5
Out[84]:
array([[[ 1.,  1.,  1.,  1.],
        [ 1.,  1.,  1.,  1.],
        [ 1.,  1.,  1.,  1.]],

       [[ 1.,  1.,  1.,  1.],
        [ 1.,  1.,  1.,  1.],
        [ 1.,  1.,  1.,  1.]],

       [[ 1.,  1.,  1.,  1.],
        [ 1.,  1.,  1.,  1.],
        [ 1.,  1.,  1.,  1.]],

       [[ 1.,  1.,  1.,  1.],
        [ 1.,  1.,  1.,  1.],
        [ 1.,  1.,  1.,  1.]]])

In [85]: a5.ndim
Out[85]: 3
```

5. ndarray 对象还可以通过 reshape 方法变形为其他维度的数组：

```python
In [89]: a = np.arange(12)

In [90]: a
Out[90]: array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11])

In [91]: a.reshape(4, 3)
Out[91]:
array([[ 0,  1,  2],
       [ 3,  4,  5],
       [ 6,  7,  8],
       [ 9, 10, 11]])
```

## 多维数组索引

1. 在NumPy中的索引方式为：
 
```python
In [104]: a = np.arange(12)

In [105]: a
Out[105]: array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11])

In [106]: a[1:4]
Out[106]: array([1, 2, 3])

In [107]: a[1:10:2]
Out[107]: array([1, 3, 5, 7, 9])
```

2. 切片赋值：

```python
In [112]: a = np.arange(12)

In [113]: a
Out[113]: array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11])

In [114]: a[1:5] = -1

In [115]: a
Out[115]: array([ 0, -1, -1, -1, -1,  5,  6,  7,  8,  9, 10, 11])

In [116]: a[1:10:2] = 1

In [117]: a
Out[117]: array([ 0,  1, -1,  1, -1,  1,  6,  1,  8,  1, 10, 11])
```

3. 多维数组切片

```python
In [158]: a = np.arange(12).reshape(3, 4)

In [159]: a.shape
Out[159]: (3, 4)

In [160]: a
Out[160]:
array([[ 0,  1,  2,  3],
       [ 4,  5,  6,  7],
       [ 8,  9, 10, 11]])

In [161]: a[0]
Out[161]: array([0, 1, 2, 3])

In [162]: a[1]
Out[162]: array([4, 5, 6, 7])

In [163]: a[:, 0]
Out[163]: array([0, 4, 8])

In [164]: a[:, 1]
Out[164]: array([1, 5, 9])

In [165]: a[:, 2]
Out[165]: array([ 2,  6, 10])

In [166]: a[0, 0]
Out[166]: 0

In [167]: a[0, 1]
Out[167]: 1

In [168]: a[1, 1]
Out[168]: 5

In [169]: a[1, 2]
Out[169]: 6

In [170]: a[0] = 1

In [171]: a
Out[171]:
array([[ 1,  1,  1,  1],
       [ 4,  5,  6,  7],
       [ 8,  9, 10, 11]])

In [172]: a[:, 1] = -1

In [173]: a
Out[173]:
array([[ 1, -1,  1,  1],
       [ 4, -1,  6,  7],
       [ 8, -1, 10, 11]])
```

4. 对于二维数组，可以通过 a[x, y] 的方式进行索引，三维数组可以通过 a[x, y, z] 的方式进行，多维数组的索引方式和其形状相关。

```python
In [192]: a = np.arange(27).reshape(3, 3, 3)

In [193]: a.ndim
Out[193]: 3

In [194]: a.shape
Out[194]: (3, 3, 3)

In [195]: a
Out[195]:
array([[[ 0,  1,  2],
        [ 3,  4,  5],
        [ 6,  7,  8]],

       [[ 9, 10, 11],
        [12, 13, 14],
        [15, 16, 17]],

       [[18, 19, 20],
        [21, 22, 23],
        [24, 25, 26]]])

In [196]: a1 = a[1]

In [197]: a1
Out[197]:
array([[ 9, 10, 11],
       [12, 13, 14],
       [15, 16, 17]])

In [198]: a1.shape
Out[198]: (3, 3)

In [199]: a2 = a[1, 1]

In [200]: a2
Out[200]: array([12, 13, 14])

In [201]: a2.shape
Out[201]: (3,)

In [202]: a2.ndim
Out[202]: 1

In [203]: a[2, 2, 2]
Out[203]: 26

In [209]: a[:, 1]
Out[209]:
array([[ 3,  4,  5],
       [12, 13, 14],
       [21, 22, 23]])

In [210]: a[:, 1] = 1

In [211]: a
Out[211]:
array([[[ 0,  1,  2],
        [ 1,  1,  1],
        [ 6,  7,  8]],

       [[ 9, 10, 11],
        [ 1,  1,  1],
        [15, 16, 17]],

       [[18, 19, 20],
        [ 1,  1,  1],
        [24, 25, 26]]])
```

5. 对于多维数组，有的时候我们想根据第二维度以后的维度来选择，但是 Python 不支持 a[, 1] 这样的语法，但可以使用 a[:, 1] 的形式，比如在上面演示的三维数组中，我们通过 a[:, 1] 选择了第二维度上的元素。

## 多维数组基础运算

1. 普通运算

```python
In [50]: a = np.arange(12).reshape(3, 4)

In [51]: a
Out[51]:
array([[ 0,  1,  2,  3],
       [ 4,  5,  6,  7],
       [ 8,  9, 10, 11]])

In [52]: a += 1

In [53]: a
Out[53]:
array([[ 1,  2,  3,  4],
       [ 5,  6,  7,  8],
       [ 9, 10, 11, 12]])

In [54]: a *= 2

In [55]: a
Out[55]:
array([[ 2,  4,  6,  8],
       [10, 12, 14, 16],
       [18, 20, 22, 24]])
```

2. 多维数组和数字（标量）间的运算非常简单，同样多维数组间的运算也非常容易：

```python
In [87]: a = np.arange(4).reshape(2, 2)

In [88]: b = np.arange(4, 8).reshape(2, 2)

In [89]: a
Out[89]:
array([[0, 1],
       [2, 3]])

In [90]: b
Out[90]:
array([[4, 5],
       [6, 7]])

In [91]: b - a
Out[91]:
array([[4, 4],
       [4, 4]])

In [92]: a + b
Out[92]:
array([[ 4,  6],
       [ 8, 10]])

In [93]: a * b
Out[93]:
array([[ 0,  5],
       [12, 21]])
```

3. 需要注意的是，多维数组的组织方式和矩阵相同，但其乘法的运算规则却和矩阵的运算规则不同，如果想对 ndarray 对象使用矩阵的乘法运算规则，可以使用 ndarray.dot 方法，比如计算上面演示代码中 a 和 b 的矩阵乘法结果：

```python
In [101]: a.dot(b)
Out[101]:
array([[ 6,  7],
       [26, 31]])
```

4. 多维数组还支持逻辑比较运算，比如我们想知道一个多维数组中哪些值大于某一个指定值？典型的做法是通过循环实现，但是在 NumPy 中却可以直接通过比较实现:

```python
In [115]: a = np.arange(12).reshape(4, 3)

In [116]: b = a > 5

In [117]: b
Out[117]:
array([[False, False, False],
       [False, False, False],
       [ True,  True,  True],
       [ True,  True,  True]], dtype=bool)

In [118]: a[b]
Out[118]: array([ 6,  7,  8,  9, 10, 11])
```

5. NumPy 的多维数组还有一些方法，可以用于统计数组中一些统计量，假如 a 为一个多维数组，则：


* a.sum 计算多维数组的所有元素的和；
* a.max 最大值计算；
* a.min 最小值计算；
* a.mean 平均值计算；
* a.std 标准差计算；
* a.var 方差计算；

6. 以上所有方法，都可以接受一个 axis 参数，用于指定具体统计哪根轴上的数据。比如二维数组，可以理解为有 x, y 两根轴，分别代表行和列，指定 axis=0 时代表分别统计每列上的数据，axis=1 时，代表分别统计每一行上的数据。没有指定axis 参数时，代表统计所有元素。示例代码如下

```python
In [132]: a
Out[132]:
array([[ 0,  1,  2],
       [ 3,  4,  5],
       [ 6,  7,  8],
       [ 9, 10, 11]])

In [133]: a.sum()
Out[133]: 66

In [134]: a.sum(axis=0)
Out[134]: array([18, 22, 26])

In [135]: a.sum(axis=1)
Out[135]: array([ 3, 12, 21, 30])
```

7. 除了 ndarray 多维数组对象自己的方法外，NumPy 还自带了一些通用函数，可以进行各种计算：

* np.sqrt 开方运算；
* np.dot 矩阵乘法；
* np.sort 排序；
* np.linalg 模块中包含了一些基本的线性代数计算函数；

# Pandas简介：

在数据分析中，我们更多的针对表格数据进行处理，也就是 NumPy 中的二维数组数据，尽管 NumPy 对于多维数组的支持已经足够强大，但 Pandas 处理这些二维数据时更加得心应手。Pandas 建立在 NumPy 基础之上，但增加了更加高级实用的功能，比如数据自动对齐功能，时间序列的支持，缺失数据的灵活处理等等。在接下来的实验中，我们将学习 Pandas 的基础知识，在学习的过程中一定要实践实例中的代码，只有这样才能真正掌握本节实验的内容。

导入：

```python
In [1]: import pandas as pd

In [2]: import numpy as np

In [3]: from pandas import Series, DataFrame
```

## Series和DataFrame

1. Series 和 DataFrame 是 Pandas 中的两种核心数据结构，大部分 Pandas 的功能都围绕着两种数据结构进行。

2. Series 是值的序列，可以理解为一维数组，它只有一个列和 索引。索引可以定制，当不指定时默认使用整数索引，而且索引可以被命名:

```python
In [28]: s1 = Series([1, 2, 3, 4, 5])

In [29]: s1
Out[29]:
0    1
1    2
2    3
3    4
4    5
dtype: int64

In [30]: s2 = Series([1, 2, 3, 4, 5], index=['a', 'b', 'c', 'd', 'e'])

In [31]: s2
Out[31]:
a    1
b    2
c    3
d    4
e    5
dtype: int64

In [32]: s2.index.name = 'index'

In [33]: s2.index
Out[33]: Index(['a', 'b', 'c', 'd', 'e'], dtype='object', name='index')
```
